<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Pheasant Invitational — Live Updates</title>
<meta name="theme-color" content="#ffffff" />
<link rel="icon" href="favicon-32.png" sizes="32x32" />

<!-- Always light mode styles -->
<style>
  :root {
    --bg:#ffffff; --card:#ffffff; --fg:#111827; --muted:#64748b; --border:#e5e7eb; --accent:#2563eb;
  }
  * { box-sizing:border-box }
  html, body { margin:0; padding:0; background:var(--bg); color:var(--fg); font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial; }
  .wrap { max-width: 780px; margin: 28px auto 40px; padding: 0 16px; }
  h1 { font-size: 24px; margin: 0 0 6px; }
  .sub { color: var(--muted); margin: 0 0 16px; }
  .feed { display:flex; flex-direction:column; gap:12px; margin-top: 12px; }
  .item { border:1px solid var(--border); border-radius:16px; padding:14px 14px 12px; background:var(--card); }
  .meta { display:flex; justify-content:space-between; align-items:center; gap:8px; font-size:12px; color:var(--muted); margin-bottom:8px; }
  .author { font-weight:600; color:var(--fg); }
  .time { white-space:nowrap; }
  .body { font-size:15px; line-height:1.45; white-space:pre-wrap; }
  .toolbar { display:flex; justify-content:space-between; align-items:center; margin-top: 4px; }
  .badge { display:inline-block; font-size:12px; padding:4px 8px; border:1px solid var(--border); border-radius:999px; color:var(--muted); }
  .loading { color: var(--muted); font-size: 14px; padding: 8px 0; }
  .error { color:#b91c1c; font-size:14px; }
  a.btn { display:inline-block; text-decoration:none; background:var(--accent); color:#fff; padding:10px 14px; border-radius:12px; font-weight:600; }
</style>
</head>
<body>
  <div class="wrap">
  <header class="page-header">
  <a href="index.html" class="btn-home" aria-label="Back to Home">←</a>
  <h2 class="page-title">Horse Race Live Updates</h2>
</header>

    <p class="sub">Real-time play-by-play for the Horse Race. Newest posts appear first.</p>

    <div class="toolbar">
      <span class="badge" id="statusBadge">Connecting…</span>
      <!-- Optional: link to your admin portal -->
    
    </div>

    <div id="notice" class="loading">Loading recent posts…</div>
    <div id="feed" class="feed" aria-live="polite"></div>
  </div>

  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <script>
    // ======= CONFIG (replace both placeholders) =======
    // ======= CONFIG (replace both placeholders) =======
const SUPABASE_URL  = 'https://xbhpcweidljpqxuryevi.supabase.co';
const SUPABASE_ANON = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhiaHBjd2VpZGxqcHF4dXJ5ZXZpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTcwOTM1OTgsImV4cCI6MjA3MjY2OTU5OH0.KeQ1CvMEdypeobmpuRK-ut8exYhYE8OeQ3h1PJFOYh8';
// Optional: force timestamps to a specific tz for display
const DISPLAY_TZ    = 'America/Los_Angeles';
// ================================================

    // ================================================

    const { createClient } = window.supabase;
    const supabase = createClient(SUPABASE_URL, SUPABASE_ANON);

    const feedEl = document.getElementById('feed');
    const notice = document.getElementById('notice');
    const statusBadge = document.getElementById('statusBadge');

    function esc(s){
      return s.replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));
    }
    function fmt(ts){
      const d = new Date(ts);
      try {
        return d.toLocaleString('en-US', { dateStyle:'medium', timeStyle:'short', timeZone: DISPLAY_TZ });
      } catch {
        return d.toLocaleString();
      }
    }
    function renderItem(row, { prepend=false } = {}){
      const div = document.createElement('div');
      div.className = 'item';
      div.innerHTML = `
        <div class="meta">
          <span class="author">${esc(row.author)}</span>
          <span class="time">${fmt(row.created_at)}</span>
        </div>
        <div class="body">${esc(row.body)}</div>
      `;
      if (prepend && feedEl.firstChild) feedEl.insertBefore(div, feedEl.firstChild);
      else feedEl.appendChild(div);
    }

    async function initialLoad(){
      statusBadge.textContent = 'Loading…';
      const { data, error } = await supabase
        .from('live_updates')
        .select('*')
        .order('created_at', { ascending: false })
        .limit(100);
      if (error){
        notice.className = 'error';
        notice.textContent = 'Failed to load updates.';
        statusBadge.textContent = 'Offline';
        console.error(error);
        return;
      }
      notice.remove();
      data.forEach(r => renderItem(r));
      statusBadge.textContent = 'Live';
    }

    function startRealtime(){
      const channel = supabase
        .channel('horse-race-live')
        .on('postgres_changes', { event:'INSERT', schema:'public', table:'live_updates' }, payload => {
          renderItem(payload.new, { prepend:true });
        })
        .subscribe((status) => {
          statusBadge.textContent = status === 'SUBSCRIBED' ? 'Live' : 'Connecting…';
        });
    }

    initialLoad();
    startRealtime();
  </script>
</body>
</html>
